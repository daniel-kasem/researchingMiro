<!DOCTYPE html>
<html lang="en">

<head>
  <script type="text/javascript" src="https://miro.com/app/static/sdk.1.1.js"></script>
  <script type="text/javascript">
    let currentSticker_X = 0
    let currentSticker_Y = 0
    let stickerCount = 0
    let stickerOffset = 50

    miro.onReady(() => {
      miro.initialize({
        extensionPoints: {
          bottomBar: {
            title: 'Asteroid sticker',
            svgIcon: '<circle cx="12" cy="12" r="9" fill="none" fill-rule="evenodd" stroke="currentColor" stroke-width="2"/>',
            onClick: async () => {
              newAsteroidSticker()
            }
          }
        }
      })
    })

    async function newAsteroidSticker() {
      //derive xy of new sticker
      currentSticker_X += stickerOffset
      currentSticker_Y += stickerOffset
      stickerCount += 1
      if (stickerCount % 4 === 0) {
        currentSticker_Y = stickerOffset
      }
      //create new sticker
      let sticker = (await miro.board.widgets.create({
        "type": "image",
        "url": "https://daniel-kasem.github.io/researchingMiro/images/asteroidPostIt.png",
        "x": currentSticker_X,
        "y": currentSticker_Y
      }))[0]
      //create new text box inside sticker
      let stickerX = (await sticker.x)
      let stickerY = (await sticker.y)
      let stickerWidth = (await sticker.bounds.width)
      let stickerHeight = (await sticker.bounds.height)
      let textBox = (await miro.board.widgets.create({
        "type": "text",
        "text": "------------Type here :O-------------",
        "x": stickerX,
        "y": stickerY,
        "width": stickerWidth
      }))[0]
      //group sticker and text box
      miro.board.selection.selectWidgets([sticker, textBox])

      //const waitTenSec = () => new Promise(r => setTimeout(r, 10000))
      //alert("...")
      //await waitTenSec()
      //alert("one sec")
      //document.getElementById('group-horiz').click()
      //let groupButton = () => new Promise(document.getElementById('group-horiz')).then(groupButton.click())
      //let elementExists = document.getElementById("group-horiz");
      //let elementExists = window.getElementById("group-horiz");
      //alert(elementExists)
      //document.getElementsByClassName('cm-custom-cm-group-group').click()

      //document.getElementById("todo").dispatchEvent(new MouseEvent("click", {ctrlKey: true}));

      setTimeout(function () {
        window.dispatchEvent(new KeyboardEvent('keydown', {
          //'keyCode': '71'
          'key': 'Control'
        }));
        window.dispatchEvent(new KeyboardEvent('keydown', {
          //'keyCode': '71'
          'key': 'g'
        }));
        window.dispatchEvent(new KeyboardEvent('keyup', {
          //'keyCode': 17
          'key': 'Control'
        }));
        window.dispatchEvent(new KeyboardEvent('keyup', {
          //'keyCode': '71'
          'key': 'g'
        }));
        alert('keys dispatched');
      }, 5000);
      await miro.board.viewport.zoomToObject(textBox)
    }
    //https://daniel-kasem.github.io/researchingMiro/main.html
    //https://daniel-kasem.github.io/researchingMiro/images/asteroidPostIt.png
  </script>
</head>

<body>
  <span>Confirm changes to main.html - 88</span>
</body>

</html>
